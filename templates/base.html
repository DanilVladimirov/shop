<!DOCTYPE html>
<html>
<head>
    {% load static %}
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="https://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script>var scrf_token = $('{% csrf_token %}').val(); </script>
    {% block head %}
    {% endblock %}
</head>
<body>

<div class="topnav">
    <a style="background-color: #2196F3;border-radius: 10px;margin: 4.5px;" class="active left_side"
       href="{% url 'start_page' %}"><img src="/static/logo_shop.png"><span>Aktezor</span></a>
    <a style="margin-top: 5px;" class="active right_side" {% if request.user.is_authenticated %}
       href="{% url 'user_page' %}" {% else %}
       href="{% url 'login' %}" {% endif %}>
        <img style="width: 40px;" src="/static/userlogo.png">
        {% if not request.user.is_authenticated %}
            <span>sign in</span>
        {% endif %}
    </a>
    <a class="active right_side" style="margin-top: 5px;" href="{% url 'checkout_page' %}">
        <img style="width: 40px;" src="/static/cart.png"></a>
    <a class="active right_side" style="margin-top: 5px;" href="#compare">
        <img style="width: 40px;" src="/static/compare_img.png"></a>
    <div class="search-container">
        <form action="{% url "search_products_page" %}">
            <input id="id_search_query" style="border-radius: 10px;margin-top: 11px;" type="text" placeholder="Search.."
                   name="q">
            <button class="button_search" type="submit" style="border-radius: 10px;margin-top: 11px;"><img
                    class="search-img" src="/static/search.png"></button>
        </form>
        <button onclick="record()" style="border-radius: 10px;margin-top: 11px;" class="button_voice"><img
                src="/static/mic.png"></button>
    </div>

    {#    <button class="button_compare" onclick="location.href='#compare'">compare</button>#}

</div>
{% block body %}

{% endblock %}
<div id="popup" class="popup">
    <a href="" class="popup_area"></a>
    <div class="popup_body">
        <div class="popup_content">
            <div class="popup_text">
                <img class="img_mic" src="/static/mic.png">
                speak
            </div>
        </div>
    </div>
</div>
<div id="compare" class="popup">
    <a href="" class="popup_area"></a>
    <div class="popup_body">
        <div class="popup_content">
            <div class="popup_text">
                <span class="text_top">Your categories to comparison:</span><br>
                {% if request.session.compare %}
                    {% for category in request.session.compare %}
                        <div id="category_{{ category }}">
                            <a class="link_category" href="{% url 'compare_page' category %}">{{ category }}</a>
                            <form class="form_delete_category" id="del_category_{{ category }}" method="post">
                                {% csrf_token %}
                                <input id="category_id_{{ category }}" type="hidden" value="{{ category }}">
                                <button onclick="remover(document.getElementById('category_id_{{ category }}').value)">
                                    <img class="img_trash" src="/static/trash.png">
                                </button>
                            </form>
                            <br>
                        </div>
                    {% endfor %}
                {% else %}
                    <span class="text_empty">empty.</span>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
    function record() {
        location.href = '#popup';
        var recognition = new webkitSpeechRecognition();
        recognition.lang = "en-US";
        recognition.onresult = function (event) {
            document.getElementById('id_search_query').value = event.results[0][0].transcript;
            location.href = "{% url 'search_products_page' %}?q=" + event.results[0][0].transcript;
        }
        recognition.start();
    }
</script>
{# delete category from comparison#}
<script type="text/javascript">
    function remover(cid) {
        var cid_ = "#category_id_" + cid;
        $(document).on('submit', "#del_category_" + cid, function (e) {
            e.preventDefault();
            $.ajax({
                type: 'POST',
                url: {% url 'del_category' %},
                data: {
                    category: $(cid_).val(),
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                },
                success: function () {
                    var categ = "#category_" + cid;
                    $(categ).remove();
                }
            });
        });
    }
</script>
</body>
</html>
