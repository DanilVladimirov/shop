{% extends 'base.html' %}
{% block head %}
    <link rel="stylesheet" href="/static/css/user-page.css">
{% endblock %}
{% block body %}

    <div class="control_panel_div">

        <div style="float: right">
            <span>Send events to my mail</span>
            {% if request.user.subscription_email %}
                <input id="sub_email" type="checkbox" checked onchange="mail_sub()">
            {% else %}
                <input id="sub_email" type="checkbox" onchange="mail_sub()">
            {% endif %}
        </div>

        <form action="/shop/currency" method="POST" id='select_currency_form' style="margin-right: 10px;float:right;">
            {% csrf_token %}
            <span>Currency:</span><select name="all_currency"
                                          onchange="document.getElementById('select_currency_form').submit()">
            {% for curr in all_currency %}
                <option value={{ curr.code }} {% if request.session.curr_id == curr.code %}selected{% endif %}>{{ curr.name }}</option>
            {% endfor %}
        </select>
        </form>

        <form class="user_change_form" id="user_full_name" style="border: 2px solid;padding: 10px;border-radius: 10px;">
            <span style="text-align: center;color: gray;">Change full name</span>
            {% csrf_token %}
            <input type="text" placeholder="first name" name="first_name">
            <input type="text" placeholder="last name" name="last_name">
            <button type="submit" class="btn change">Change</button>
        </form>

        <button onclick="location.href='{% url 'logout' %}'" class="btn sign_out">sign out</button>
        <button class="btn my_products" onclick="location.href='{% url 'wishlist_page' %}'">wishlist</button>
        <button class="btn my_products" onclick="location.href='{% url 'support_main_page' %}'">my tickets
        </button>
        <button class="btn my_products" onclick="location.href='{% url 'subscribe' %}'">telegram
        </button>
        {% load shop_tags %}
        {% if request.user|has_group:"Seller" %}
            <button class="btn my_products" onclick="location.href='{% url 'seller_products' %}'">my products</button>
        {% endif %}
        {% if request.user|has_group:"Courier" %}
            <button class="btn my_products" onclick="location.href='{% url 'courier_page' %}'">invoices
            </button>
        {% endif %}
        {% if request.user|has_group:"Moder" %}
            <hr>
            Moder:
            <div>
                <button class="btn my_products" onclick="location.href='{% url 'create_promocode_page' %}'">promo-code
                </button>
                <button class="btn my_products" onclick="location.href='{% url 'edit_price_in_category' %}'">edit
                    price
                </button>
                <button class="btn my_products" onclick="location.href='{% url 'import_products' %}'">import
                </button>
                <button class="btn my_products" onclick="location.href='{% url 'export_products' %}'">export
                </button>
                <button class="btn my_products" onclick="location.href='{% url 'parser_rozetka' %}'">parser
                </button>
                <button class="btn my_products" onclick="location.href='{% url 'all_ticket_page' %}'">tickets
                </button>
                <button class="btn my_products" onclick="location.href='{% url 'invoices_page' %}'">invoices
                </button>
                <hr>
                Nova Poshta:<br>
                <button class="btn my_products" onclick="location.href='{% url 'update_cities_np' %}'">update cities
                </button>
                <button style="width: 200px;" class="btn my_products"
                        onclick="location.href='{% url 'update_warehouses_np' %}'">update
                    warehouses
                </button>
            </div>
        {% endif %}

    </div>
    <script>
        function mail_sub() {
            $.ajax({
                type: 'POST', url: '{% url "mail_sub" %}',
                data: {'csrfmiddlewaretoken': scrf_token},
                dataType: 'json',
                cache: false,
                success: function (data) {
                    if (data.sub) {

                    } else {

                    }
                }
            });
        }

        $('#user_full_name').submit(function (e) {
            e.preventDefault();
            $form = $(this)
            var formData = new FormData(this);
            $.ajax({
                url: {% url 'change_fullname' %},
                type: 'POST',
                data: formData,
                success: function (response) {
                    if (response.success) {
                        $('#user_full_name')[0].reset();
                    } else {

                    }
                },
                cache: false,
                contentType: false,
                processData: false
            });
        });
    </script>
{% endblock %}